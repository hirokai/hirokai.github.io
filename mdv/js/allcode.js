function scaleTime(a,b){var c=_.min(_.map(a,function(a){return a.time}));return(b-c)/1e3*timeScale}function _updateImages(a,b,c,d,e,f,g){dot=d3.select("g.dot");var h=300;if(b.length>h)return svg.append("text").attr("id","message-svg").attr({x:g.props.width/2,y:g.props.height/2,fill:"orange","text-anchor":"middle"}).text("Too many (>"+h+") images. Filter by other conditions."),dot=dot.selectAll("g").data([],function(a){return a.uuid}),void dot.exit().remove();d3.select("#message-svg").remove(),b=_.map(_.sortBy(b,function(a){return a[c.sortKey]}),function(a){return a}),c.sortReverse&&(b=b.reverse());var c=c||{};dot=dot.selectAll("g").data(b,function(a){return a.uuid}),dot.exit().remove();var i=dot.enter().append("g"),j=Math.round(1.25*Math.sqrt(b.length)),k=size*c.marginRatio,l=function(a,d){var e=d%j,f=c.tile?size*c.marginRatio*e:"x"==c.mapX?-a.x:"y"==c.mapX?-a.y:"pos"==c.mapX?a.pos*k:"time"==c.mapX?scaleTime(b,a.time):"frame"==c.mapX?a.frame*k:"ch"==c.mapX?a.ch*k:"slice"==c.mapX?a.slice*k:("const"==c.mapX,0);return isNaN(f)?0:f},m=function(a,d){var e=Math.floor(d/j),f=c.tile?size*c.marginRatio*e:"x"==c.mapY?-a.x:"y"==c.mapY?-a.y:"pos"==c.mapY?a.pos*k:"time"==c.mapY?scaleTime(b,a.time):"frame"==c.mapY?a.frame*k:"ch"==c.mapY?a.ch*k:"slice"==c.mapY?a.slice*k:("const"==c.mapY,0);return isNaN(f)?0:f};i.append("image").attr("x",l).attr("y",m).attr("xlink:href",function(b){return imghref(imgbasename(a,b),"s1")}).attr("data-basename",function(b){return imgbasename(a,b,"s1")}).attr({"data-res":"s1",width:size,height:size,alt:function(a){return a.name}}).on("click",d),i.append("rect").attr("x",l).attr("y",m).attr("class","imgbox").attr({width:size,height:size}),dot.select("rect").transition().ease("cubic-out").attr("x",l).attr("y",m).style({stroke:function(a){return e[a.uuid]?"pink":"#333"},"stroke-width":function(a){return e[a.uuid]?2:1}});var n=dot.select("image").transition().ease("cubic-out").attr("x",l).attr("y",m);f&&n.each("end",function(){var a=$("image");if(a.length>0){var b=[],d=[];a.each(function(){b.push(parseFloat($(this).attr("x"))),d.push(parseFloat($(this).attr("y")))});var e=.9*Math.min((axisPos.right-axisPos.left)/(_.max(b)-_.min(b)+size*c.marginRatio),(axisPos.bottom-axisPos.top)/(_.max(d)-_.min(d)+size*c.marginRatio)),f=axisPos.left+10-e*_.min(b),g=axisPos.top+10-e*_.min(d);zoom.translate([f,g]),zoom.scale(e),zoom.event(svg.transition().duration(500))}})}function calculateOptimalZoom(a){a=a||1.1;var b=[],c=[];$("image").each(function(){b.push(parseFloat($(this).attr("x"))),c.push(parseFloat($(this).attr("y")))});var d=.9*Math.min((axisPos.right-axisPos.left)/(_.max(b)-_.min(b)+size*a),(axisPos.bottom-axisPos.top)/(_.max(c)-_.min(c)+size*a)),e=axisPos.left+10-d*_.min(b),f=axisPos.top+10-d*_.min(c);return[e,f,d]}function calculateAxisDomain(a,b,c,d,e){if(_.contains(["x","y","z"],a))return"x"==d?[(axisPos.left-b[0])/c,(axisPos.right-b[0])/c]:[(axisPos.bottom-b[1])/c,(axisPos.top-b[1])/c];var f=size*e;if(_.contains(["pos","frame","ch","slice","const"],a))return"x"==d?[(axisPos.left-b[0])/f/c-(2-e)/2,(axisPos.right-b[0])/f/c-(2-e)/2]:[(axisPos.bottom-b[1])/f/c-(2-e)/2,(axisPos.top-b[1])/f/c-(2-e)/2];if("time"==a){var g=timeScale;return"x"==d?[(axisPos.left-b[0])/g/c,(axisPos.right-b[0])/g/c]:[(axisPos.bottom-b[1])/g/c,(axisPos.top-b[1])/g/c]}return[0,100]}function updateImageResolution(a){if(a>2.5){var b=0;$("svg image").each(function(a,c){var d=$(c).attr("data-basename"),e=$(c).attr("data-res");"s1"==e&&($(c).attr("href",imghref(d,"full")),b+=1)})}}function imghref(a,b){var c={s1:"_s1.jpg",full:".png"};return a+c[b]}function imgbasename(a,b){return"images/"+(a.metaset?b.set_uuid:a.uuid)+"/"+b.uuid}var container,size=131.5,mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),w=screen.width,h=screen.height,zoom,svg,ImgPanel=React.createClass({displayName:"ImgPanel",propTypes:{dataset:React.PropTypes.object.isRequired,width:React.PropTypes.number.isRequired,height:React.PropTypes.number.isRequired,allimages:React.PropTypes.array.isRequired,images:React.PropTypes.array.isRequired,preloadCache:React.PropTypes.bool,showOpt:React.PropTypes.object,coord:React.PropTypes.object,filterDims:React.PropTypes.object,selected:React.PropTypes.object,onChangeSelected:React.PropTypes.func.isRequired},render:function(){return React.createElement("div",{id:"imagePanel"},React.createElement("div",{id:"img-tool"},React.createElement(ColorPickers,null),React.createElement("button",{style:{"float":"right"},id:"zoomAll",className:"btn btn-default btn-sm",onClick:this.zoomAllClicked},"Zoom to show all"),React.createElement("span",{style:{"float":"right"}},"Mouse wheel to zoom, drag to pan.")),React.createElement("svg",{id:"map"}))},zoomAllClicked:function(){var a=calculateOptimalZoom();zoom.translate([a[0],a[1]]),zoom.scale(a[2]),zoom.event(svg.transition().duration(500))},componentDidMount:function(){this.setupD3(!0),this.updateImages(this.props.images,this.props.showOpt,!0)},isImageMappingChanged:function(a){return a.showOpt.tile!=this.props.showOpt.tile||a.showOpt.mapX!=this.props.showOpt.mapX||a.showOpt.mapY!=this.props.showOpt.mapY||!_.isEqual(a.filterDims,this.props.filterDims)},componentDidUpdate:function(a){var b=this.isImageMappingChanged(a);this.updateImages(this.props.images,this.props.showOpt,b),this.props.dataset.uuid!=a.dataset.uuid&&this.setupD3(!1),this.props.preloadCache&&this.preloadCache()},margin:{top:-5,right:-5,bottom:-5,left:-5},setupD3:function(a){this.width=(mobile?.9*w:this.props.width)-this.margin.left-this.margin.right,this.height=(mobile?.5*h:this.props.height)-this.margin.top-this.margin.bottom,zoom=d3.behavior.zoom().scaleExtent([.02,10]).on("zoom",this.zoomed),$("#map").html("");var b=-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome"),c=navigator.userAgent.indexOf("MSIE")>-1;if(a||!b&&!c){svg=d3.select("#map").style("width",""+(this.width+this.margin.left+this.margin.right)+"px").style("height",""+(this.height+this.margin.top+this.margin.bottom)+"px").append("g").call(zoom);var d=(svg.append("rect").attr("width",this.width).attr("height",this.height).style("fill","none").style("pointer-events","all"),1);container=svg.append("g");var e=svg.append("g");e.append("rect").attr({x:10,y:10,width:d,height:20}).style({fill:"white"}),this.setupAxes(container),dot=container.append("g").attr("class","dot")}},updateImages:function(a,b,c){_updateImages(this.props.dataset,a,b,this.click,this.props.selected,c,this),this.updateAxisLabels(),updateImageResolution(this.scale)},click:function(a){function b(){var a=navigator.platform.toUpperCase().indexOf("MAC")>=0;return a&&d3.event.metaKey||!a&&d3.event.shiftKey}b()||this.props.onChangeSelected("removeAll"),this.props.selected[a.uuid]?this.props.onChangeSelected("remove",a.uuid):this.props.onChangeSelected("add",a.uuid);var c=this;dot.select("rect").style({stroke:function(a){return c.props.selected[a.uuid]?"pink":"#333"},"stroke-width":function(a){return c.props.selected[a.uuid]?2:1}})},preloadCache:function(){$("#imgcache").remove();var a=$('<div id="imgcache"></div>');$(document.body).append(a),a.hide();var b=this;_.map(this.props.allimages,function(c){var d=$("<img/>");d.attr("src",imghref(imgbasename(b.props.dataset,c),"s1")),a.append(d)})},scale:1,zoomed:function(){function a(a,b){_.contains(["pos","frame","ch","slice"],a)?this.scale>.1&&b.tickValues(null):b.tickValues("time"==a?null:"const"==a?[0]:null)}var b=d3.event.translate,c=d3.event.scale;container.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),this.scale=d3.event.scale,updateImageResolution(d3.event.scale);var d=this.props.showOpt.tile?"x":this.props.showOpt.mapX,e=this.props.showOpt.tile?"y":this.props.showOpt.mapY;xAxisScale.domain(calculateAxisDomain(d,b,c,"x",this.props.showOpt.marginRatio)),yAxisScale.domain(calculateAxisDomain(e,b,c,"y",this.props.showOpt.marginRatio)),xAxis.scale(xAxisScale),yAxis.scale(yAxisScale),a(d,xAxis),a(e,yAxis),xAxisObj.call(xAxis),yAxisObj.call(yAxis)},setupAxes:function(a){var b=1200;a.append("g").attr("class","x axis").selectAll("line").data(d3.range(-b,b,10)).enter().append("line").attr("x1",function(a){return a}).attr("y1",-b).attr("x2",function(a){return a}).attr("y2",b),a.append("g").attr("class","y axis").selectAll("line").data(d3.range(-b,b,10)).enter().append("line").attr("x1",-b).attr("y1",function(a){return a}).attr("x2",b).attr("y2",function(a){return a}),xAxisScale=d3.scale.linear().domain([0,100]).range([axisPos.left,axisPos.right]),yAxisScale=d3.scale.linear().domain([0,100]).range([axisPos.bottom,axisPos.top]),xAxis=d3.svg.axis().scale(xAxisScale).orient("bottom").ticks(10).innerTickSize([10]).tickFormat(d3.format("d")),yAxis=d3.svg.axis().scale(yAxisScale).orient("left").ticks(10).innerTickSize([10]).tickFormat(d3.format("d")),xAxisObj=svg.append("g").attr("transform","translate(0,"+axisPos.bottom+")").attr("class","x axis primary"),yAxisObj=svg.append("g").attr("transform","translate("+axisPos.left+",0)").attr("class","y axis primary"),this.xLabel=xAxisObj.append("g").attr("transform","translate("+(axisPos.left+(axisPos.right-axisPos.left)/2)+",40)").append("text").attr("text-anchor","middle").text("X position [um]"),this.yLabel=yAxisObj.append("g").attr("transform","translate(-40,"+(axisPos.top+(axisPos.bottom-axisPos.top)/2)+") rotate(270)").append("text").attr("text-anchor","middle").text("Y position [um]")},updateAxisLabels:function(){function a(a,c){_.contains(["pos","frame","ch","slice"],a)?c.text(b[a]+" index"):"x"==a?c.text("X position [um]"):"y"==a?c.text("Y position [um]"):"z"==a?c.text("Z position [um]"):"time"==a?c.text("Time [sec]"):"const"==a&&c.text("")}var b={pos:"Position",frame:"Frame",ch:"Channel",slice:"Slice"},c=this.props.showOpt.tile?"x":this.props.showOpt.mapX,d=this.props.showOpt.tile?"y":this.props.showOpt.mapY;a(c,this.xLabel),a(d,this.yLabel)}}),axisPos={left:60,right:800,bottom:550,top:20},axisW=axisPos.right-axisPos.left,axisH=axisPos.bottom-axisPos.top,timeScale=1,timescale=function(a,b){var c=_.map(a,function(a){return a.time}).sort(),d=_.min(c),e=_.max(c),f=1/(e-d)*size*c.length;return[(b-d)*f,f]},App=React.createClass({displayName:"App",getInitialState:function(){return{datasets:{},currentDataset:null,dims:{}}},render:function(){return React.createElement("div",null,React.createElement("div",{className:"col-md-3"},React.createElement("p",null,"Choose dataset"),React.createElement("ul",{id:"data-menu",className:"nav nav-pills nav-stacked"},_.map(this.state.datasets,function(a,b){return React.createElement(DataSetEntry,{key:b,data:a,"data-uuid":b})}))),React.createElement(RightPane,{dataset:this.state.currentDataset}))},filterDimChanged:function(a){},componentDidMount:function(){var a=this;d3.csv("datasets.csv",function(a){return a.metaset=0!=+a.metaset,a.positions=+a.positions,a.frames=+a.frames,a.channels=+a.channels,a.slices=+a.slices,a.meta_pos=+a.meta_pos,a.meta_frame=+a.met_frame,a.meta_ch=+a.meta_ch,a.meta_slice=+a.meta_slice,a.dims={},a.dims.pos=a.meta_pos||a.positions,a.dims.frame=a.meta_frame||a.frames,a.dims.ch=a.meta_ch||a.channels,a.dims.slice=a.meta_slice||a.slices,a.images=+a.images,a},function(b,c){ds={},_.map(c,function(a){ds[a.uuid]=a}),a.setState({datasets:ds}),$(".dmenu").click(function(b){var c=$(b.target),d="li"==c.tagName?c:c.parents("li");d.parents("ul").children("li").removeClass("active"),d.addClass("active"),a.setState({currentDataset:a.state.datasets[d.attr("data-uuid")]})}),$($(".dmenu > a")[0]).click()})}}),DataSetEntry=React.createClass({displayName:"DataSetEntry",render:function(){var a=this.props.data,b=["positions","frames","channels","slices"],c={positions:"P",frames:"T",channels:"C",slices:"Z"},d=_.compact(_.map(b,function(b){return a[b]>1?c[b]+a[b]:null})).join(" x ");return React.createElement("li",{role:"presentation","data-uuid":a.uuid,className:"dmenu"},React.createElement("a",{href:"#"},a.name," ",React.createElement("p",null,"(",a.images," images: ",d,")")))}}),RightPane=React.createClass({displayName:"RightPane",propTypes:{dataset:React.PropTypes.object},getInitialState:function(){return{images:[],dims:{pos:null,frame:null,ch:null,slice:null},coord:{pos:null,frame:null,ch:null,slice:null},selectedImages:[],filterDims:{pos:!1,frame:!1,ch:!1,slice:!1},selected:{},show:{tile:!0,mapX:"x",mapY:"y",sortKey:"time",marginRatio:1.1},startTime:null}},render:function(){return this.props.dataset?React.createElement("div",{className:"col-md-9"},React.createElement("div",{id:"tools"},React.createElement(Tags,{dims:this.props.dataset.dims}),React.createElement("div",{style:{clear:"both"}}),React.createElement(DimFilters,{dims:this.props.dataset.dims,filterDims:this.state.filterDims,onChangeFilterDims:this.filterDimChanged,onChangeCoord:this.coordChanged}),React.createElement(FilterInfo,{selectedImages:this.state.selectedImages,filterDims:this.state.filterDims,coord:this.state.coord,show:this.state.show,remainingDim:this.calcRemainingDim()}),React.createElement("div",null,React.createElement(MapTools,{remainingDim:this.calcRemainingDim(),dims:this.state.dims,onClickMapMode:this.onClickMapMode,show:this.state.show,remainingDim:this.calcRemainingDim(),onMapXYChange:this.onMapXYChange,onChangeSort:this.onChangeSort,onChangeSortReverse:this.onChangeSortReverse}),React.createElement("div",{style:{clear:"both"}}))),React.createElement("div",{style:{clear:"both"}}),React.createElement(ImgPanel,{dataset:this.props.dataset,allimages:this.state.images,images:this.state.selectedImages,showOpt:this.state.show,width:900,height:600,preloadCache:!1,selected:this.state.selected,onChangeSelected:this.onChangeSelected,coord:this.state.coord,filterDims:this.state.filterDims})):React.createElement("div",{className:"col-md-9"},"Select dataset")},onMapXYChange:function(a){var b=_.extend({},this.state.show);b.mapX=a[0],b.mapY=a[1],this.setState({show:b})},onChangeSort:function(a){var b=_.extend({},this.state.show);b.sortKey=a,this.setState({show:b})},onChangeSortReverse:function(a){var b=_.extend({},this.state.show);b.sortReverse=a,this.setState({show:b})},onClickMapMode:function(a){var b=_.extend({},this.state.show);b.tile=a,this.setState({show:b})},coordChanged:function(a){var b=_.extend({},this.state.coord);b[a.key]=a.value,this.setState({coord:b,selectedImages:this.selectImages(this.state.images,this.state.filterDims,b),remainingDim:this.calcRemainingDim()})},calcRemainingDim:function(){var a=[],b=this;return _.map(["pos","frame","ch","slice"],function(c){b.state.dims[c]>1&&!b.state.filterDims[c]&&a.push(c)}),a},filterDimChanged:function(a){var b=this.state.filterDims,c={},d=this.state.coord;_.map(["pos","frame","ch","slice"],function(e){c[e]=a[e]?b[e]?d[e]:0:null}),this.setState({filterDims:a,remainingDim:this.calcRemainingDim(),coord:c,selectedImages:this.selectImages(this.state.images,a,c)})},onChangeSelected:function(a,b){},selectImages:function(a,b,c){var d=_.filter(a,function(a){return!(b.pos&&null!=c.pos&&(a.meta_pos||a.pos)!=c.pos||b.ch&&null!=c.ch&&(a.meta_ch||a.ch)!=c.ch||b.frame&&null!=c.frame&&(a.meta_frame||a.frame)!=c.frame||b.slice&&null!=c.slice&&(a.meta_slice||a.slice)!=c.slice)});return d},componentDidUpdate:function(a){var b=this.props.dataset;b&&b!=a.dataset&&this.datasetChanged()},datasetChanged:function(){var a=this,b=this.props.dataset;d3.csv("metadata/"+b.uuid+".csv",function(a){return a.x=+a.x,a.y=+a.y,a.pos=+a.meta_pos||+a.pos,a.frame=+a.meta_frame||+a.frame,a.ch=+a.meta_ch||+a.ch,a.slice=+a.meta_slice||+a.slice,a.meta_pos=+a.meta_pos,a.meta_frame=+a.meta_frame,a.meta_ch=+a.meta_ch,a.meta_slice=+a.meta_slice,a.time=moment(a.stime,"YYYY-MM-DD HHmm:ss Z").valueOf()+parseInt(a.time),a},function(c,d){var e=_.map(d,function(a){return a.time}),f=(_.min(e),{});f.pos=b.meta_pos||b.positions,f.frame=b.meta_frame||b.frames,f.ch=b.meta_ch||b.channels,f.slice=b.meta_slice||b.slices;var g=_.sortBy(Object.keys(f),function(a){return-f[a]})[0],h={};h[g]=0;var i={};i.frame=!1,i.ch=!1,i.slice=!1,i[g]=!0;var j=this.selectImages(d,i,h);a.setState({images:d,selectedImages:j,dims:f,coord:h,filterDims:i})}.bind(this))}}),Tags=React.createClass({displayName:"Tags",render:function(){return React.createElement("div",{id:"tags"},this.props.dims.pos>1?React.createElement("span",{className:"label label-default tag"},"Positions"):"",this.props.dims.frame>1?React.createElement("span",{className:"label label-primary tag"},"Frames"):"",this.props.dims.ch>1?React.createElement("span",{className:"label label-warning tag"},"Channels"):"",this.props.dims.slice>1?React.createElement("span",{className:"label label-success tag"},"Slices"):"")}}),DimFilters=React.createClass({displayName:"DimFilters",propTypes:{dims:React.PropTypes.object.isRequired,filterDims:React.PropTypes.object.isRequired},render:function(){return React.createElement("div",{id:"dim-select-btns"},React.createElement("div",null,React.createElement("span",{style:{margin:"0px 10px 10px 20px"}},"Select by"),React.createElement("div",{className:"btn-group",role:"group","aria-label":"..."},this.btn("Position","pos",this.toggleDim,this.props.dims.pos>1,this.props.filterDims.pos),this.btn("Frame","frame",this.toggleDim,this.props.dims.frame>1,this.props.filterDims.frame),this.btn("Channel","ch",this.toggleDim,this.props.dims.ch>1,this.props.filterDims.ch),this.btn("Slice","slice",this.toggleDim,this.props.dims.slice>1,this.props.filterDims.slice)),React.createElement("span",{style:{margin:"0px 10px 10px 20px"}},"Preset"),React.createElement("div",{className:"btn-group",role:"group","aria-label":"..."},this.btnp("No filter","",this.dimPreset,!0),this.btnp("Pos x Frame","pos,frame",this.dimPreset,this.props.dims.pos>1&&this.props.dims.frame>1),this.btnp("Frame x Ch","frame,ch",this.dimPreset,this.props.dims.frame>1&&this.props.dims.ch>1),this.btnp("Pos x Ch","pos,ch",this.dimPreset,this.props.dims.pos>1&&this.props.dims.ch>1),this.btnp("Pos x Slice","pos,slice",this.dimPreset,this.props.dims.pos>1&&this.props.dims.slice>1))),this.props.filterDims.pos?React.createElement(Slider,{dim:"pos",max:this.props.dims.pos-1,onChange:this.onChangeCoord}):"",this.props.filterDims.frame?React.createElement(Slider,{dim:"frame",max:this.props.dims.frame-1,onChange:this.props.onChangeCoord}):"",this.props.filterDims.ch?React.createElement(Slider,{dim:"ch",max:this.props.dims.ch-1,onChange:this.props.onChangeCoord}):"",this.props.filterDims.slice?React.createElement(Slider,{dim:"slice",max:this.props.dims.slice-1,onChange:this.props.onChangeCoord}):"")},toggleDim:function(a){var b=$(a.nativeEvent.target),c=b.attr("data-value"),d=_.extend({},this.props.filterDims);d[c]=!d[c],this.props.onChangeFilterDims(d)},dimPreset:function(a){var b=$(a.nativeEvent.target).attr("data-value").split(","),c=_.object(_.map(["pos","frame","ch","slice"],function(a){return[a,_.contains(b,a)]}));this.props.onChangeFilterDims(c)},btn:function(a,b,c,d,e){var f=React.addons.classSet,g=f({btn:!0,"btn-sm":!0,"btn-default":!0,"dim-btn":!0,active:e});return React.createElement("button",{id:"dim-"+b,onClick:c,className:g,key:a,"data-value":b,disabled:d?"":"disabled"},a)},btnp:function(a,b,c,d){var e=React.addons.classSet,f=e({btn:!0,"btn-xs":!0,"preset-btn":!0,"btn-default":!0});return React.createElement("button",{onClick:c,className:f,key:a,"data-value":b,disabled:d?"":"disabled"},a)},componentDidMount:function(){},onChangeCoord:function(a){this.props.onChangeCoord(a)}}),ColorPickers=React.createClass({displayName:"ColorPickers",render:function(){return React.createElement("div",null,React.createElement("label",{htmlFor:"colorpicker-bg"},"Background"),React.createElement("input",{id:"colorpicker-bg",className:"color",defaultValue:"#000"}),React.createElement("label",{htmlFor:"colorpicker-fg"},"Foreground"),React.createElement("input",{id:"colorpicker-fg",className:"color",defaultValue:"#fff"}),React.createElement("label",{htmlFor:"colorpicker-grid"},"Grid"),React.createElement("input",{id:"colorpicker-grid",className:"color",defaultValue:"#333"}),React.createElement("span",{style:{marginLeft:"30px"}},"Preset"),React.createElement("div",{className:"btn-group",role:"group","aria-label":"..."},React.createElement("button",{type:"button",className:"btn btn-xs btn-default color-preset",onClick:this.presetColor,"data-value":"000,fff,333"},"Dark"),React.createElement("button",{type:"button",className:"btn btn-xs btn-default color-preset",onClick:this.presetColor,"data-value":"fff,000,ccc"},"Bright")))},presetColor:function(a){var b=$(a.nativeEvent.target),c=b.attr("data-value").split(",");$("#colorpicker-bg").val(c[0]).trigger("change"),$("#colorpicker-fg").val(c[1]).trigger("change"),$("#colorpicker-grid").val(c[2]).trigger("change")},componentDidMount:function(){this.startColor("colorpicker-bg","000"),this.startColor("colorpicker-fg","fff"),this.startColor("colorpicker-grid","333"),$("#colorpicker-bg").on("change",function(){$("svg").css("background","#"+$(this).val())}),$("#colorpicker-fg").on("change",function(){$("svg text,.axis.primary").css("fill","#"+$(this).val())}),$("#colorpicker-grid").on("change",function(){$("svg line").css("stroke","#"+$(this).val())})},startColor:function(a,b){var c=new jscolor.color(document.getElementById(a),{});c.fromString(b)}}),Slider=React.createClass({displayName:"Slider",propTypes:{dim:React.PropTypes.string.isRequired},getInitialState:function(){return{slider:null,value:0}},slider:null,render:function(){var a=this.props.dim;return React.createElement("div",{id:a+"-slider-wrap"},React.createElement("span",{style:{marginRight:"30px"}},this.fullname[a]),React.createElement("input",{id:a+"-slider-input","data-slider-id":a+"-slider",type:"text","data-slider-step":"1"}))},fullname:{pos:"Position",frame:"Frame",ch:"Channel",slice:"Slice"},componentDidMount:function(){this.slider=$("#"+this.props.dim+"-slider-input").slider({min:0,max:this.props.max,value:this.props.value}).on("change",this.changedDebounce()).data("slider"),this.slider.setValue(0)},componentDidUpdate:function(){this.slider.setAttribute("max",this.props.max),this.slider.setValue(this.props.value)},shouldComponentUpdate:function(a){return a.max!=this.props.max},changed:function(a){a.value!=this.props.value&&this.props.onChange({key:this.props.dim,value:this.slider.getValue()})},changedDebounce:function(){return $.throttle(100,this.changed)},componentWillUnmount:function(){this.state.slider&&this.state.slider.destroy()}}),FilterInfo=React.createClass({displayName:"FilterInfo",getSelectInfo:function(a){if(!a)return"Not valid images.";var b={pos:"positions",frame:"frames",ch:"channels",slice:"slices"},c={pos:"position",frame:"frame",ch:"channel",slice:"slice"},d=_.map(this.props.remainingDim,function(a){return b[a]}),e=a.length>1?a.length+" images (multiple "+d.join(", ")+")":0==a.length?"No image":"1 image",f=_.compact(_.map(this.props.coord,function(a,b){return null!=a?c[b]+"="+a:null})).join(", "),g=this.props.show.tile?"Tile, sorted by "+this.props.show.sortKey+(this.props.show.sortReverse?" (reversed)":""):"Mapping: x="+this.props.show.mapX+", y="+this.props.show.mapY;return"Showing "+(f?"":"all ")+e+(f?" of "+f:"")+". "+g},render:function(){var a=this.getSelectInfo(this.props.selectedImages);return React.createElement("div",{id:"filterinfo"},React.createElement("pre",null,a))}}),MapTools=React.createClass({displayName:"MapTools",propTypes:{onClickMapMode:React.PropTypes.func,onMapXYChange:React.PropTypes.func,onChangeSortReverse:React.PropTypes.func,onChangeSort:React.PropTypes.func,remainingDim:React.PropTypes.array.isRequired,show:React.PropTypes.object.isRequired},getInitialState:function(){return{}},render:function(){return React.createElement("div",{id:"map-tools"},React.createElement("span",{style:{margin:"0px 10px 10px 20px"}},"Mapping"),React.createElement("div",{className:"btn-group",role:"group","aria-label":"...",style:{marginRight:"10px"}},React.createElement("button",{type:"button",className:"btn btn-default btn-sm map-select"+(this.props.show.tile?" active":""),id:"map-tile",onClick:this.onClickMapMode},"Tile"),React.createElement("button",{type:"button",className:"btn btn-default btn-sm map-select"+(this.props.show.tile?"":" active"),id:"map-2d",onClick:this.onClickMapMode},"X/Y")),this.props.show.tile?this.sortTool():this.xyTool())},sortTool:function(){return React.createElement("div",{id:"sort-tool"},React.createElement("label",{htmlFor:"tile-sort"},"Sort by"),React.createElement("select",{name:"",id:"tile-sort",onChange:this.onChangeSort},this.sortOptions()),React.createElement("input",{type:"checkbox",id:"sort-reverse",checked:this.props.show.sortReverse?"checked":"",onChange:this.onClickSortReverse,style:{marginLeft:"10px"}}),React.createElement("label",{htmlFor:"sort-reverse"},"Reverse"))},xyTool:function(){var a=[["Stage X/Y","x,y"],["Frame/Slice","frame,slice"],["Time/Pos","time,pos"],["Ch/Pos","ch,pos"]],b=this;return React.createElement("div",{id:"xy-tool"},React.createElement("label",{htmlFor:"xcoord"},"X"),React.createElement("select",{name:"",id:"xcoord",value:this.props.show.mapX,onChange:this.onChangeCoord},this.coordOpts()),React.createElement("button",{id:"switch-xy",className:"btn btn-xs btn-default",style:{cursor:"pointer",margin:"0px 7px"},onClick:this.onClickSwitch}," ↔ "),React.createElement("label",{htmlFor:"ycoord"},"Y"),React.createElement("select",{name:"",id:"ycoord",value:this.props.show.mapY,onChange:this.onChangeCoord},this.coordOpts()),React.createElement("span",{style:{marginLeft:"30px"}},"Preset"),React.createElement("div",{className:"btn-group",role:"group","aria-label":"..."},_.map(a,function(a){return React.createElement("button",{type:"button",key:a[1],className:"btn btn-xs btn-default map-preset","data-value":a[1],id:"map-xy",onClick:b.onClickXYPreset},a[0])})))},onClickMapMode:function(a){var b="map-tile"==$(a.nativeEvent.target).attr("id");this.props.onClickMapMode(b)},onChangeSort:function(a){this.props.onChangeSort($(a.nativeEvent.target).val())},onClickSortReverse:function(a){this.props.onChangeSortReverse($(a.nativeEvent.target).prop("checked"))},onClickSwitch:function(){this.props.onMapXYChange([this.props.show.mapY,this.props.show.mapX])},onChangeCoord:function(a){var b="xcoord"==$(a.nativeEvent.target).attr("id"),c=$(a.nativeEvent.target).val();this.props.onMapXYChange(b?[c,this.props.show.mapY]:[this.props.show.mapX,c])},onClickXYPreset:function(a){var b=$(a.nativeEvent.target).attr("data-value").split(",");this.props.onMapXYChange(b)},sortOptions:function(){var a=[];return _.contains(this.props.remainingDim,"pos")&&this.props.dims.pos>1&&a.push(React.createElement("option",{value:"pos",key:"0"},"Position index")),_.contains(this.props.remainingDim,"frame")&&this.props.dims.frame>1&&a.push(React.createElement("option",{value:"frame",key:"1"},"Frame index")),_.contains(this.props.remainingDim,"ch")&&this.props.dims.ch>1&&a.push(React.createElement("option",{value:"ch",key:"2"},"Channel index")),_.contains(this.props.remainingDim,"slice")&&this.props.dims.slice>1&&a.push(React.createElement("option",{value:"slice",key:"3"},"Slice index")),a.push(React.createElement("option",{value:"time",key:"4"},"Time")),a},coordOpts:function(){return[React.createElement("option",{value:"const",key:"const"},"Constant"),React.createElement("option",{value:"x",key:"x"},"Stage X"),React.createElement("option",{value:"y",key:"y"},"Stage Y"),React.createElement("option",{value:"z",key:"z"},"Stage Z"),React.createElement("option",{value:"pos",key:"pos"},"Position index"),React.createElement("option",{value:"frame",key:"frame"},"Frame index"),React.createElement("option",{value:"ch",key:"ch"},"Channel index"),React.createElement("option",{value:"slice",key:"slice"},"Slice index"),React.createElement("option",{value:"time",key:"time"},"Time")]}}),ImgInfo=React.createClass({displayName:"ImgInfo",render:function(){var a=_.map(this.props.selectedImages,function(a){var b=(a.time-startTime)/1e3;return React.createElement("tr",{key:a.uuid},React.createElement("td",null,a.uuid),React.createElement("td",null,this.path(currentDataset,a)),React.createElement("td",null,""+Math.floor(b)+"."+Math.floor(10*b)%10),React.createElement("td",null,a.pos),React.createElement("td",null,a.frame),React.createElement("td",null,a.ch),React.createElement("td",null,a.slice))});return React.createElement("div",{className:"col-md-12",id:"info"},React.createElement("table",{id:"info",className:"table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"UUID"),React.createElement("th",null,"Path"),React.createElement("th",null,"Time [sec]"),React.createElement("th",null,"Pos"),React.createElement("th",null,"Frame"),React.createElement("th",null,"Channel"),React.createElement("th",null,"Slice"))),React.createElement("tbody",null,a)))},path:function(a,b){function c(a,b){var c="000000000"+a;return c.substr(c.length-b)}var d=dataset[a];return d.metaset?b.folder+"/Pos0/img_"+c(b.frame,9)+"_"+b.chname+"_"+c(b.slice,3)+".tif":d.folder+"/"+b.posname+"/img_"+c(b.frame,9)+"_"+b.chname+"_"+c(b.slice,3)+".tif"}});$(function(){$.throttle=jq_throttle=function(a,b,c,d){function e(){function e(){g=+new Date,c.apply(i,k)}function h(){f=void 0}var i=this,j=+new Date-g,k=arguments;d&&!f&&e(),f&&clearTimeout(f),void 0===d&&j>a?e():b!==!0&&(f=setTimeout(d?h:e,void 0===d?a-j:a))}var f,g=0;return"boolean"!=typeof b&&(d=c,c=b,b=void 0),$.guid&&(e.guid=c.guid=c.guid||$.guid++),e},$.debounce=function(a,b,c){return void 0===c?jq_throttle(a,b,!1):jq_throttle(a,c,b!==!1)},React.render(React.createElement(App,null),document.getElementById("app"))});
//# sourceMappingURL=allcode.js.map